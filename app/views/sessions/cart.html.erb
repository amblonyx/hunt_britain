<% provide(:title, "Shopping cart") %>

<h1>Shopping Cart</h1>
<div class="row">
<div class="span10 offset1">
<% if @action == "checkout" %>
	Name: <%= current_user.name %>
	Email: <%= current_user.email %>
	<%= output_phone(current_user.phone) %>
	
	Paper hunts will be sent to:
	<address>
		<%= output_address_line(current_user.address_1) %>
		<%= output_address_line(current_user.address_2) %>
		<%= output_address_line(current_user.town) %>
		<%= output_address_line(current_user.county) %>
		<%= output_address_line(current_user.postcode) %>
		<%= output_address_line(current_user.country) %>
	</address>
	
	PDFs and Links to the online hunt will be sent to:
	<%= current_user.email %>
	
<% end %>

<%= form_tag("/update_cart", id: "updateCartForm", method: "put") do %>

	<table class="table table-bordered table-striped">
		<thead>
			<tr>
				<th>Product Name</th>
				<th>Quantity</th>
				<th>Price per unit</th>
				<th>Total Price</th>
				<th></th>
			</tr>
		</thead>
		<tbody>
			<% total_price = 0 %>
			
			<% @cart.each do |cart_item| %>
				<% product = Product.find(cart_item[:product_id]) %>
				<% total_price += product.price * cart_item[:num].to_i %>
				<tr>
					<td><%= product.name %></td>
					<td>
					<% if @action == "cart" %>
						<%= text_field_tag "product[" + cart_item[:product_id] + "]", cart_item[:num] %>
					<% else %>
						<%= cart_item[:num] %>
					<% end %>
					</td>
					<td>£<%= "%.2f" % (product.price / 100.0) %></td>
					<td>£<%= "%.2f" % (cart_item[:num].to_i * product.price / 100.0) %></td>
					<td>
						<% if @action == "cart" %>
							<%= link_to "Remove", remove_from_cart_path(product_id: product.id), method: :post %>
						<% end %>
					</td>
				</tr>
			<% end %>
			<tr>  
			  <td></td>
			  <td></td>
			  <td><strong>Grand Total:</strong></td>
			  <td>£<%= "%.2f" % (total_price / 100.0) %></td>
			  <td></td>
			</tr>
		<tbody>
	</table>
	
	<% if @action == "cart" %>
		<%= submit_tag "Update", class: "btn btn-large btn-primary" %>
	<% end %>
<% end %>


<%= link_to "Continue shopping", root_path %>
<% if @action == "cart" %>
	| <%= link_to "Checkout", checkout_path %>
<% else %>
	| <%= link_to "Pay with Paypal", @paypal_link %>
<% end %>

</div>
</div>


