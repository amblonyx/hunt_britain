<% provide(:title, "Shopping cart") %>

<h1>Shopping Cart</h1>
<%= form_tag("/update_cart", id: "updateCartForm", method: "post") do %>

	<table class="table table-bordered table-striped">
		<thead>
			<tr>
				<th>Product Name</th>
				<th>Quantity</th>
				<th>Price per unit</th>
				<th>Total Price</th>
				<th></th>
			</tr>
		</thead>
		<tbody>
			<% total_price = 0 %>
			
			<% @cart.each do |cart_item| %>
				<% product = Product.find(cart_item[:product_id]) %>
				<% total_price += product.price * cart_item[:num] %>
				<tr>
					<td><%= product.name %></td>
					<td>
					<% if @action == "cart" %>
						<%= text_field_tag "product[" + cart_item[:product_id] + "]", cart_item[:num] %>
					<% else %>
						<%= cart_item[:num] %>
					<% end %>
					</td>
					<td>£<%= "%.2f" % (product.price / 100.0) %></td>
					<td>£<%= "%.2f" % (cart_item[:num] * product.price / 100.0) %></td>
					<td>
						<% if @action == "cart" %>
							<%= link_to "Remove", "delete_cart_item[" + cart_item[:product_id] + "]" %>
						<% end %>
					</td>
				</tr>
			<% end %>
			<tr>  
			  <td></td>
			  <td></td>
			  <td><strong>Grand Total:</strong></td>
			  <td>£<%= "%.2f" % (total_price / 100.0) %></td>
			  <td></td>
			</tr>
		<tbody>
	</table>
	
	<% if @action == "cart" %>
		<%= submit_tag "Update" %>
	<% end %>
<% end %>

<%= link_to "Continue shopping", root_path %>
<% if @action == "cart" %>
	<%= link_to "Checkout", checkout_path %>
<% else %>
	<%= link_to "Pay with Paypal", @paypal_link %>
<% end %>
